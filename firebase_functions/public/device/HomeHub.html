<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>HomeHub</title>
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="manifest" href="site.webmanifest">
  <meta name="generator" content="Google Web Designer 10.0.2.0105">
  <meta name="template" content="Expandable 3.0.0">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="gwdpage_style.css" rel="stylesheet" data-version="13" data-exports-type="gwd-page">
  <link href="gwdpagedeck_style.css" rel="stylesheet" data-version="14" data-exports-type="gwd-pagedeck">
  <link href="gwdimage_style.css" rel="stylesheet" data-version="15" data-exports-type="gwd-image">
  <style type="text/css" id="gwd-lightbox-style">
    .gwd-lightbox {
      overflow: hidden;
    }
  </style>
  <style type="text/css" id="gwd-text-style">
    p {
      margin: 0px;
    }

    h1 {
      margin: 0px;
    }

    h2 {
      margin: 0px;
      color: rgb(189, 189, 189);
      font-family: Roboto;
      font-weight: bold;
      text-align: center;
    }

    h3 {
      margin: 0px;
    }
  </style>
  <style type="text/css">
    html,
    body {
      width: 100%;
      height: 100%;
      margin: 0px;
    }

    .gwd-page-container {
      position: relative;
      width: 100%;
      height: 100%;
    }

    .gwd-page-content {
      background-color: transparent;
      transform: perspective(1400px) matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      transform-style: preserve-3d;
      position: absolute;
    }

    .gwd-page-wrapper {
      position: absolute;
      transform: translateZ(0px);
      background-color: rgb(255, 255, 255);
    }

    .page1-content {
      width: 550px;
      height: 400px;
    }

    .gwd-div-1tb5 {
      width: 478px;
      height: 318px;
    }

    .gwd-page-1u9q {
      background-image: none;
      background-color: rgb(33, 33, 33);
      width: 478px;
      height: 318px;
    }

    .gwd-div-sedl {
      position: absolute;
      left: 50%;
      top: 0%;
      width: 50%;
      height: 50%;
      border-image-source: none;
      border-image-width: 1;
      border-image-outset: 0;
      border-image-repeat: stretch;
      border-color: rgb(189, 189, 189);
      border-style: solid;
      border-width: 1px;
    }

    .gwd-div-1f67 {
      position: absolute;
      left: 0%;
      top: 50%;
      width: 50%;
      height: 50%;
      border-image-source: none;
      border-image-width: 1;
      border-image-outset: 0;
      border-image-repeat: stretch;
      border-color: rgb(189, 189, 189);
      border-style: solid;
      border-width: 1px;
    }

    .gwd-div-e5qt {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 50%;
      height: 50%;
      border-image-source: none;
      border-image-width: 1;
      border-image-outset: 0;
      border-image-repeat: stretch;
      border-color: rgb(189, 189, 189);
      border-style: solid;
      border-width: 1px;
    }

    .gwd-div-11bi {
      position: absolute;
      left: 0%;
      top: 0%;
      width: 50%;
      height: 50%;
      border-image-source: none;
      border-image-width: 1;
      border-image-outset: 0;
      border-image-repeat: stretch;
      border-color: rgb(189, 189, 189);
      border-style: solid;
      border-width: 1px;
    }

    .gwd-div-10v4 {
      position: absolute;
      left: 0%;
      top: 0%;
      width: 100%;
      height: 33%;
    }

    .gwd-div-jw3x {
      position: absolute;
      left: 0%;
      top: 38.75%;
      width: 100%;
      height: 61.25%;
    }

    .gwd-p-1l5k {
      left: 10px;
      position: absolute;
      top: 50%;
      transform-origin: 50% 50% 0px;
      transform-style: preserve-3d;
      font-weight: bold;
      width: 240px;
      height: 26px;
      transform: translate3d(-10px, -13px, 0px);
    }

    .gwd-span-rcc3 {
      text-align: center;
    }

    .gwd-div-1m88 {
      position: absolute;
      height: 100%;
      top: 0%;
      width: 60%;
      left: 40%;
    }

    .gwd-p-clf6 {
      color: rgb(189, 189, 189);
      font-family: Roboto;
      font-size: 50px;
      left: 50%;
      position: absolute;
      top: 50%;
      transform: matrix(1, 0, 0, 1, -39, -29);
      transform-style: preserve-3d;
    }

    .gwd-div-4y1e {
      position: absolute;
      left: 0%;
      top: 0%;
      height: 100%;
      width: 40%;
    }

    .gwd-div-uwqw {
      position: absolute;
      left: -0.42%;
      top: 0%;
      width: 100%;
      height: 33%;
    }

    .gwd-div-igl5 {
      position: absolute;
      left: -0.42%;
      top: 33%;
      width: 100%;
      height: 66%;
    }

    .gwd-div-bisw {
      position: absolute;
      left: -0.42%;
      width: 50.42%;
      height: 100%;
      top: 0%;
    }

    .gwd-div-5ivv {
      position: absolute;
      left: 50%;
      width: 49.58%;
      height: 100%;
      top: 0%;
    }

    .gwd-image-1nu8 {
      position: absolute;
      height: 80%;
      width: 80%;
      top: 10%;
      left: 10%;
    }

    .gwd-p-n1x6 {
      transform: translate3d(-60px, -29px, 0px);
      text-align: center;
    }

    .gwd-image-17po {
      top: 10%;
    }

    .gwd-div-153a {
      width: 40%;
    }

    .gwd-div-1tt9 {
      left: 40%;
      width: 60%;
    }

    .gwd-p-7nkh {
      transform: translate3d(-60px, -29px, 0px);
      text-align: center;
    }

    .gwd-div-8sgo {
      width: 40%;
    }

    .gwd-div-qwfe {
      left: 40%;
      width: 60%;
    }

    .gwd-p-1yhd {
      transform: translate3d(-60px, -29px, 0px);
      text-align: center;
    }

    .gwd-div-4i3c {
      width: 100%;
    }

    .gwd-div-2gj4 {
      left: 0%;
      width: 0%;
    }

    .gwd-p-jvt5 {
      transform: translate3d(-60px, -29px, 0px);
      text-align: center;
    }
  </style>
  <link
    href="https://fonts.googleapis.com/css?family=Roboto:100,100italic,300,300italic,regular,italic,500,500italic,700,700italic,900,900italic"
    rel="stylesheet" type="text/css">
  <script data-source="googbase_min.js" data-version="4" data-exports-type="googbase" src="googbase_min.js"></script>
  <script data-source="gwd_webcomponents_v1_min.js" data-version="2" data-exports-type="gwd_webcomponents_v1"
    src="gwd_webcomponents_v1_min.js"></script>
  <script data-source="gwdpage_min.js" data-version="13" data-exports-type="gwd-page" src="gwdpage_min.js"></script>
  <script data-source="gwdpagedeck_min.js" data-version="14" data-exports-type="gwd-pagedeck"
    src="gwdpagedeck_min.js"></script>
  <script data-source="gwdimage_min.js" data-version="15" data-exports-type="gwd-image" src="gwdimage_min.js"></script>
  <!-- JQUERY -->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

  <script defer src="/__/firebase/9.6.1/firebase-app-compat.js"></script>
  <script defer src="/__/firebase/9.6.1/firebase-database-compat.js"></script>
  <script defer src="/__/firebase/init.js?useEmulator=true"></script>
  <script src="config.js"></script>
</head>

<body class="document-body">
  <gwd-pagedeck class="gwd-page-container" id="pagedeck">
    <gwd-page id="page1" class="gwd-page-wrapper page1-content gwd-lightbox gwd-page-1u9q" data-gwd-width="478px"
      data-gwd-height="318px">
      <div class="gwd-page-content page1-content gwd-div-1tb5">
        <div class="gwd-div-e5qt">
          <div class="gwd-div-igl5">
            <div class="gwd-div-5ivv gwd-div-2gj4">
              <p class="gwd-p-clf6 gwd-p-jvt5" id="status-text"></p>
            </div>
            <div class="gwd-div-bisw gwd-div-4i3c">
              <gwd-image class="gwd-image-1nu8" id="temp-status-image" source="assets/green.png" scaling="contain">
              </gwd-image>
            </div>
          </div>
          <div class="gwd-div-uwqw">
            <h2 class="gwd-p-1l5k" id="status-tittle">Estado<br></h2>
          </div>
        </div>
        <div class="gwd-div-1f67">
          <div class="gwd-div-igl5">
            <div class="gwd-div-5ivv gwd-div-qwfe">
              <p class="gwd-p-clf6 gwd-p-1yhd" id="temp-cald-text">30.0º</p>
            </div>
            <div class="gwd-div-bisw gwd-div-8sgo">
              <gwd-image class="gwd-image-1nu8" id="temp-cald-image" source="assets/cald.svg" scaling="contain">
              </gwd-image>
            </div>
          </div>
          <div class="gwd-div-uwqw">
            <h2 class="gwd-p-1l5k" id="temp-cald-tittle">Tº Configurada<br></h2>
          </div>
        </div>
        <div class="gwd-div-sedl">
          <div class="gwd-div-igl5">
            <div class="gwd-div-5ivv gwd-div-1tt9">
              <p class="gwd-p-clf6 gwd-p-7nkh" id="temp-int-text">30.0º</p>
            </div>
            <div class="gwd-div-bisw gwd-div-153a">
              <gwd-image class="gwd-image-1nu8" id="temp-int-image" source="assets/house.svg" scaling="contain">
              </gwd-image>
            </div>
          </div>
          <div class="gwd-div-uwqw">
            <h2 class="gwd-p-1l5k" id="temp-int-tittle">Tº Interior<br></h2>
          </div>
        </div>
        <div class="gwd-div-11bi">
          <div class="gwd-div-jw3x">
            <div class="gwd-div-1m88">
              <p class="gwd-p-clf6 gwd-p-n1x6 text-tool-feedback" id="temp-ext-text">30.0º</p>
            </div>
            <div class="gwd-div-4y1e">
              <gwd-image class="gwd-image-1nu8 gwd-image-17po" id="temp-ext-image" source="assets/sun.svg"
                scaling="contain"></gwd-image>
            </div>
          </div>
          <div class="gwd-div-10v4">
            <h2 class="gwd-p-1l5k" id="temp-ext-tittle">Tº Exterior</h2>
          </div>
        </div>
      </div>
    </gwd-page>
  </gwd-pagedeck>
  <script type="text/javascript" id="gwd-init-code">

    function initRTDB() {
      const activePath = '/root/devices/casa_laura_adrian/status/active'
      firebase.database().ref(activePath).on('value', snapshot => {
        const active = snapshot.val()
        console.log(activePath + " -> " + active)
        if (active === true) {
          $("#temp-status-image").attr("source", "assets/green.png");
        } else {
          $("#temp-status-image").attr("source", "assets/red.png");
        }
      });

      const temperaturePath = '/root/devices/casa_laura_adrian/status/temperature'
      firebase.database().ref(temperaturePath).on('value', snapshot => {
        const temperature = snapshot.val()
        console.log(temperaturePath + " -> " + temperature)
        if (temperature) {
          $("#temp-int-text").html(temperature.toFixed(1) + "º")
        }
      });

      const thresholdPath = '/root/devices/casa_laura_adrian/configuration/threshold'
      firebase.database().ref(thresholdPath).on('value', snapshot => {
        const threshold = snapshot.val()
        console.log(thresholdPath + " -> " + threshold)
        if (threshold) {
          $("#temp-cald-text").html(threshold.toFixed(1) + "º")
        }
      });

      try {
        let app = firebase.app();
        let features = [
          'auth',
          'database',
          'firestore',
          'functions',
          'messaging',
          'storage',
          'analytics',
          'remoteConfig',
          'performance',
        ].filter(feature => typeof app[feature] === 'function');
        console.log(`Firebase SDK loaded with ${features.join(', ')}`);
      } catch (e) {
        console.error(e);
      }
    }

    function loadExternalWeatherData() {
      console.log("loadExternalWeatherData")
      $.getJSON("https://api.openweathermap.org/data/2.5/weather?lat=40.295932644448435&lon=-3.8262439145919807&appid=" + config.OPENWEATHER_API_KEY + "&units=metric", function (json) {
        if (json) {
          $("#temp-ext-text").html(json["main"]["temp"].toFixed(1) + "º")
          $("#temp-ext-image").attr("source", "http://openweathermap.org/img/w/" + json["weather"][0]["icon"] + ".png")
        }
      });
    }

    (function () {
      document.body.style.opacity = "0";
      var pageDeck = document.getElementById('pagedeck');
      /**
       * Handles the DOMContentLoaded event. The DOMContentLoaded event is
       * fired when the document has been completely loaded and parsed.
       */

      function handleDomContentLoaded(event) {
        console.log("handleDomContentLoaded")
        initRTDB();
        loadExternalWeatherData();
        setInterval(loadExternalWeatherData, 10 * 60 * 1000);
      }

      /**
       * Handles the WebComponentsReady event. This event is fired when all
       * custom elements have been registered and upgraded.
       */
      function handleWebComponentsReady(event) {
        document.body.style.opacity = "";
        setTimeout(function () {
          pageDeck.goToPage(pageDeck.getDefaultPage().id);
        }, 0);
      }

      window.addEventListener('DOMContentLoaded',
        handleDomContentLoaded, false);
      window.addEventListener('WebComponentsReady',
        handleWebComponentsReady, false);
    })();
  </script>
</body>

</html>